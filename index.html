<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OptInBot Widget Configurator</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React Libraries (Production versions for better compatibility) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel to transpile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        /* Simple style to improve color picker appearance */
        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        input[type="color"]::-webkit-color-swatch {
            border: none;
            border-radius: 0.375rem; /* rounded-md */
        }
    </style>
</head>
<body class="bg-gray-50">

    <!-- The React app will be mounted here -->
    <div id="root"></div>

    <script type="text/babel">
        // --- COLOR UTILITY FUNCTIONS ---
        function hexToHsl(H) {
            let r = 0, g = 0, b = 0;
            if (H.length == 4) {
                r = "0x" + H[1] + H[1]; g = "0x" + H[2] + H[2]; b = "0x" + H[3] + H[3];
            } else if (H.length == 7) {
                r = "0x" + H[1] + H[2]; g = "0x" + H[3] + H[4]; b = "0x" + H[5] + H[6];
            }
            r /= 255; g /= 255; b /= 255;
            let cmin = Math.min(r,g,b), cmax = Math.max(r,g,b), delta = cmax - cmin, h = 0, s = 0, l = 0;
            if (delta == 0) h = 0;
            else if (cmax == r) h = ((g - b) / delta) % 6;
            else if (cmax == g) h = (b - r) / delta + 2;
            else h = (r - g) / delta + 4;
            h = Math.round(h * 60);
            if (h < 0) h += 360;
            l = (cmax + cmin) / 2;
            s = delta == 0 ? 0 : delta / (1 - Math.abs(2 * l - 1));
            s = +(s * 100).toFixed(1);
            l = +(l * 100).toFixed(1);
            return { h, s, l };
        }

        function hslToHex(h, s, l) {
            s /= 100; l /= 100;
            let c = (1 - Math.abs(2 * l - 1)) * s, x = c * (1 - Math.abs((h / 60) % 2 - 1)), m = l - c/2, r = 0, g = 0, b = 0;
            if (0 <= h && h < 60) { r = c; g = x; b = 0; }
            else if (60 <= h && h < 120) { r = x; g = c; b = 0; }
            else if (120 <= h && h < 180) { r = 0; g = c; b = x; }
            else if (180 <= h && h < 240) { r = 0; g = x; b = c; }
            else if (240 <= h && h < 300) { r = x; g = 0; b = c; }
            else if (300 <= h && h < 360) { r = c; g = 0; b = x; }
            r = Math.round((r + m) * 255).toString(16); g = Math.round((g + m) * 255).toString(16); b = Math.round((b + m) * 255).toString(16);
            if (r.length == 1) r = "0" + r; if (g.length == 1) g = "0" + g; if (b.length == 1) b = "0" + b;
            return "#" + r + g + b;
        }

        function lightenColor(hex, percent) {
            const { h, s, l } = hexToHsl(hex);
            const newLightness = Math.min(100, l + (100 - l) * (percent / 100));
            return hslToHex(h, s, newLightness);
        }

        // --- COLOR PRESETS DATA ---
        const baseColors = [ { name: 'Ocean Blue', color: '#08788B' }, { name: 'Forest Green', color: '#27AE60' }, { name: 'Ruby Red', color: '#C0392B' }, { name: 'Royal Purple', color: '#8E44AD' }, { name: 'Sunny Yellow', color: '#F1C40F' }, { name: 'Tangerine', color: '#E67E22' }, { name: 'Deep Sea', color: '#2C3E50' }, { name: 'Sky Blue', color: '#3498DB' }, { name: 'Mint Green', color: '#1ABC9C' }, { name: 'Hot Pink', color: '#D946EF' }, { name: 'Indigo', color: '#6610f2' }, { name: 'Charcoal', color: '#343A40' }, { name: 'Crimson', color: '#E74C3C' }, { name: 'Amethyst', color: '#9B59B6' }, { name: 'Teal', color: '#008080' }, { name: 'Maroon', color: '#800000' }, { name: 'Olive', color: '#808000' }, { name: 'Coral', color: '#FF7F50' }, { name: 'Salmon', color: '#FA8072' }, { name: 'Steel Blue', color: '#4682B4' }, ];
        const colorPresets = baseColors.map(preset => ({ name: preset.name, primary: preset.color, user: lightenColor(preset.color, 75), bot: '#F3F4F6' }));

        // --- CLOUDINARY CONFIGURATION ---
        // IMPORTANT: Replace these placeholders with your actual Cloudinary details.
        const CLOUDINARY_CLOUD_NAME = 'dlasog0p4'; // <-- PASTE YOUR CLOUD NAME HERE
        const CLOUDINARY_UPLOAD_PRESET = 'chatbot-icons'; // <-- PASTE YOUR UPLOAD PRESET HERE

        // --- MAIN APP COMPONENT ---
        function App() {
            // --- STATE MANAGEMENT ---
            const initialTheme = {
                primaryColor: '#08788B',
                userBubbleColor: lightenColor('#08788B', 75),
                botBubbleColor: '#F3F4F6',
                welcomeMessage: 'Hello! How can I help you today?',
                customIconUrl: 'https://www.svgrepo.com/show/490933/chat.svg',
                headerTitle: 'Chat with our AI Assistant',
                headerIconUrl: 'https://www.svgrepo.com/show/474732/assistant.svg',
                inputPlaceholder: 'Type your message...',
                suggestedMessages: [
                    'What are your pricing plans?',
                    'How does the chatbot work?',
                    'Can I customize the widget?',
                    'Talk to a human'
                ],
                openAfterDelay: false,
                openDelaySeconds: 5,
                openOnScroll: false,
                openOnScrollThreshold: 50,
                showWelcomeBubble: true,
                welcomeBubbleText: 'Hey there! ðŸ‘‹ Have a question?',
                welcomeBubbleColor: '#FFFFFF',
                welcomeBubbleTextColor: '#000000',
                welcomeBubbleDelaySeconds: 2,
                showPoweredByBranding: true,
                showOnlineStatus: true,
            };

            const [n8nWebhookUrl, setN8nWebhookUrl] = React.useState('');
            const [clientId, setClientId] = React.useState('');
            const [chatbotId, setChatbotId] = React.useState('');
            const [theme, setTheme] = React.useState(initialTheme);
            const [generatedCode, setGeneratedCode] = React.useState('');
            const [copyButtonText, setCopyButtonText] = React.useState('Copy Code');
            const [saveButtonText, setSaveButtonText] = React.useState('Save');
            const [isThemeSettingsOpen, setIsThemeSettingsOpen] = React.useState(true);
            const [isCodeModalOpen, setIsCodeModalOpen] = React.useState(false);

            // --- DERIVED STATE & HELPERS ---
            const handleThemeChange = (prop, value) => {
                setTheme(prevTheme => ({ ...prevTheme, [prop]: value }));
            };

            const handleSuggestedMessagesChange = (textValue) => {
                const messages = textValue.split('\n').filter(msg => msg.trim() !== '');
                handleThemeChange('suggestedMessages', messages);
            };
            
            const handlePresetSelect = (preset) => {
                setTheme(prevTheme => ({ ...prevTheme, primaryColor: preset.primary, userBubbleColor: preset.user, botBubbleColor: preset.bot, }));
            };

            // --- EFFECTS ---
            // Effect to handle incoming data from Softr via postMessage
            React.useEffect(() => {
                const handleMessage = (event) => {
                    // A list of allowed domains for security
                    const trustedOrigins = ['https://optinbot.softr.app', 'https://optinbot.preview.softr.app']; 
                    
                    if (!trustedOrigins.includes(event.origin)) {
                        return;
                    }

                    const data = event.data;
                    if (data && data.type === 'optinbot-config-data') {
                        if (data.webhookUrl) setN8nWebhookUrl(data.webhookUrl);
                        if (data.clientId) setClientId(data.clientId);
                        if (data.chatbotId) setChatbotId(data.chatbotId);
                    }
                };

                window.addEventListener('message', handleMessage);

                // Cleanup listener on component unmount
                return () => {
                    window.removeEventListener('message', handleMessage);
                };
            }, []); // Empty dependency array ensures this runs only once on mount

            // Effect to load settings from localStorage on initial render
            React.useEffect(() => {
                try {
                    const savedSettings = localStorage.getItem('optinbotConfiguratorSettings');
                    if (savedSettings) {
                        const { n8nWebhookUrl, clientId, chatbotId, theme } = JSON.parse(savedSettings);
                        // Only set from localStorage if not already set by postMessage
                        if (n8nWebhookUrl && !n8nWebhookUrl) setN8nWebhookUrl(n8nWebhookUrl);
                        if (clientId && !clientId) setClientId(clientId);
                        if (chatbotId && !chatbotId) setChatbotId(chatbotId);
                        if (theme) setTheme(prevTheme => ({ ...initialTheme, ...theme }));
                    }
                } catch (error) {
                    console.error("Failed to load settings from localStorage:", error);
                }
            }, []);

            // Effect to generate embed code whenever settings change
            React.useEffect(() => {
                const configTheme = { ...theme };
                if (configTheme.showPoweredByBranding) {
                    configTheme.poweredByText = 'Powered By OptInBot.io';
                    configTheme.poweredByUrl = 'https://optinbot.io';
                } else {
                    delete configTheme.poweredByText;
                    delete configTheme.poweredByUrl;
                }
                // ... (other conditional deletions) ...

                const code = `<script>
  window.optinbotConfig = {
    n8nWebhookUrl: "${n8nWebhookUrl}",
    theme: ${JSON.stringify(configTheme, null, 2)},
    clientId: "${clientId}",
    chatbotId: "${chatbotId}"
  };
<\/script>
<link rel="stylesheet" href="https://cdn.optinbot.io/assets/index-CUXWrvdX.css">
<div id="optinbot-chatbot-container"></div>
<script type="module" crossorigin src="https://cdn.optinbot.io/assets/index-Bi7XmMpf.js"><\/script>`;
                setGeneratedCode(code);
            }, [n8nWebhookUrl, clientId, chatbotId, theme]);

            // --- EVENT HANDLERS ---
            const handleSaveSettings = () => {
                try {
                    const settingsToSave = { n8nWebhookUrl, clientId, chatbotId, theme };
                    localStorage.setItem('optinbotConfiguratorSettings', JSON.stringify(settingsToSave));
                    setSaveButtonText('Saved!');
                    setTimeout(() => setSaveButtonText('Save'), 2000);
                } catch (error) {
                    console.error("Failed to save settings to localStorage:", error);
                    setSaveButtonText('Save Failed');
                    setTimeout(() => setSaveButtonText('Save'), 2000);
                }
            };

            const handleCopyCode = React.useCallback(() => {
                // ... (copy logic remains the same) ...
            }, [generatedCode]);

            // --- RENDER ---
            return (
                <div className="bg-gray-50 font-sans p-4 sm:p-6 lg:p-8">
                    <div className="max-w-7xl mx-auto">
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                            {/* ----- Left Column: Form ----- */}
                            <div className="bg-white rounded-xl shadow-md" style={{height: '800px'}}>
                               <div className="p-6 h-full overflow-y-auto space-y-6">
                                    <div className="space-y-4 border-b border-gray-200 pb-6">
                                        <h2 className="text-xl font-semibold text-gray-700">General Settings</h2>
                                        <div>
                                            <label htmlFor="clientId" className="block text-sm font-medium text-gray-700 mb-1">Client ID</label>
                                            <input type="text" id="clientId" value={clientId} className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-100" readOnly />
                                        </div>
                                        <div>
                                            <label htmlFor="chatbotId" className="block text-sm font-medium text-gray-700 mb-1">Chatbot ID</label>
                                            <input type="text" id="chatbotId" value={chatbotId} className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-100" readOnly />
                                        </div>
                                    </div>
                                     <div>
                                        <button
                                            onClick={() => setIsThemeSettingsOpen(!isThemeSettingsOpen)}
                                            className="w-full flex justify-between items-center text-left text-xl font-semibold text-gray-700"
                                        >
                                            Theme Settings
                                            <svg className={`w-6 h-6 transform transition-transform ${isThemeSettingsOpen ? 'rotate-180' : ''}`} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"></path></svg>
                                        </button>
                                        {isThemeSettingsOpen && (
                                            <div className="mt-4 space-y-6 pt-4 border-t border-gray-200">
                                                <ColorPresets presets={colorPresets} onSelect={handlePresetSelect} />
                                                <div className="space-y-4">
                                                    <h3 className="text-md font-semibold text-gray-600">Custom Colors</h3>
                                                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                                        <ColorInput label="Primary Color" value={theme.primaryColor} onChange={(e) => handleThemeChange('primaryColor', e.target.value)} />
                                                        <ColorInput label="User Bubble Color" value={theme.userBubbleColor} onChange={(e) => handleThemeChange('userBubbleColor', e.target.value)} />
                                                        <ColorInput label="Bot Bubble Color" value={theme.botBubbleColor} onChange={(e) => handleThemeChange('botBubbleColor', e.target.value)} />
                                                    </div>
                                                </div>
                                                <div className="space-y-4 pt-4 border-t border-gray-200">
                                                     <h3 className="text-md font-semibold text-gray-600">Text & Content</h3>
                                                    <div>
                                                        <label htmlFor="welcomeMessage" className="block text-sm font-medium text-gray-700 mb-1">Welcome Message</label>
                                                        <textarea id="welcomeMessage" value={theme.welcomeMessage} onChange={(e) => handleThemeChange('welcomeMessage', e.target.value)} rows="3" className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                                                    </div>
                                                    <div>
                                                        <label htmlFor="headerTitle" className="block text-sm font-medium text-gray-700 mb-1">Header Title</label>
                                                        <input type="text" id="headerTitle" value={theme.headerTitle} onChange={(e) => handleThemeChange('headerTitle', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" />
                                                    </div>
                                                    <div>
                                                        <label htmlFor="inputPlaceholder" className="block text-sm font-medium text-gray-700 mb-1">Input Placeholder</label>
                                                        <input type="text" id="inputPlaceholder" value={theme.inputPlaceholder} onChange={(e) => handleThemeChange('inputPlaceholder', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" />
                                                    </div>
                                                    <div>
                                                        <label htmlFor="suggestedMessages" className="block text-sm font-medium text-gray-700 mb-1">Frequently Asked Questions</label>
                                                        <textarea 
                                                            id="suggestedMessages" 
                                                            value={theme.suggestedMessages.join('\n')} 
                                                            onChange={(e) => handleSuggestedMessagesChange(e.target.value)} 
                                                            rows="4" 
                                                            className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
                                                            placeholder="Enter one question per line..."
                                                        ></textarea>
                                                    </div>
                                                </div>
                                                <div className="space-y-4 pt-4 border-t border-gray-200">
                                                     <h3 className="text-md font-semibold text-gray-600">Icons</h3>
                                                     <ImageUploadInput 
                                                        label="Custom Chat Button Icon"
                                                        value={theme.customIconUrl}
                                                        onChange={(newUrl) => handleThemeChange('customIconUrl', newUrl)}
                                                     />
                                                     <ImageUploadInput 
                                                        label="Header Icon"
                                                        value={theme.headerIconUrl}
                                                        onChange={(newUrl) => handleThemeChange('headerIconUrl', newUrl)}
                                                     />
                                                </div>
                                                <div className="space-y-4 pt-4 border-t border-gray-200">
                                                    <h3 className="text-md font-semibold text-gray-600">Auto-Open Behavior</h3>
                                                    <CheckboxInput label="Open after delay" checked={theme.openAfterDelay} onChange={(e) => handleThemeChange('openAfterDelay', e.target.checked)} />
                                                    {theme.openAfterDelay && (
                                                        <div className="pl-6">
                                                            <label htmlFor="openDelaySeconds" className="block text-sm font-medium text-gray-700 mb-1">Delay (seconds)</label>
                                                            <input type="number" min="0" id="openDelaySeconds" value={theme.openDelaySeconds} onChange={(e) => handleThemeChange('openDelaySeconds', parseInt(e.target.value, 10))} className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" />
                                                        </div>
                                                    )}
                                                    <CheckboxInput label="Open on scroll" checked={theme.openOnScroll} onChange={(e) => handleThemeChange('openOnScroll', e.target.checked)} />
                                                    {theme.openOnScroll && (
                                                        <div className="pl-6">
                                                            <label htmlFor="openOnScrollThreshold" className="block text-sm font-medium text-gray-700 mb-1">Scroll Threshold (%)</label>
                                                            <input type="number" id="openOnScrollThreshold" value={theme.openOnScrollThreshold} min="0" max="100" onChange={(e) => handleThemeChange('openOnScrollThreshold', parseInt(e.target.value, 10))} className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" />
                                                        </div>
                                                    )}
                                                </div>
                                                <div className="space-y-4 pt-4 border-t border-gray-200">
                                                    <h3 className="text-md font-semibold text-gray-600">Welcome Bubble</h3>
                                                    <CheckboxInput label="Show welcome bubble" checked={theme.showWelcomeBubble} onChange={(e) => handleThemeChange('showWelcomeBubble', e.target.checked)} />
                                                    {theme.showWelcomeBubble && (
                                                        <div className="pl-6 space-y-4">
                                                            <div>
                                                                <label htmlFor="welcomeBubbleText" className="block text-sm font-medium text-gray-700 mb-1">Bubble Text</label>
                                                                <input type="text" id="welcomeBubbleText" value={theme.welcomeBubbleText} onChange={(e) => handleThemeChange('welcomeBubbleText', e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" />
                                                            </div>
                                                            <div>
                                                                <label htmlFor="welcomeBubbleDelaySeconds" className="block text-sm font-medium text-gray-700 mb-1">Bubble Delay (seconds)</label>
                                                                <input type="number" min="0" id="welcomeBubbleDelaySeconds" value={theme.welcomeBubbleDelaySeconds} onChange={(e) => handleThemeChange('welcomeBubbleDelaySeconds', parseInt(e.target.value, 10))} className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm" />
                                                            </div>
                                                        </div>
                                                    )}
                                                </div>
                                                <div className="pt-4 border-t border-gray-200 space-y-2">
                                                    <h3 className="text-md font-semibold text-gray-600 mb-2">Branding & Status</h3>
                                                    <CheckboxInput label="Show 'Powered By' Branding" checked={theme.showPoweredByBranding} onChange={(e) => handleThemeChange('showPoweredByBranding', e.target.checked)} />
                                                    <CheckboxInput label="Show Online Status" checked={theme.showOnlineStatus} onChange={(e) => handleThemeChange('showOnlineStatus', e.target.checked)} />
                                                </div>
                                            </div>
                                        )}
                                    </div>
                               </div>
                            </div>

                            {/* ----- Right Column: Live Preview & Code ----- */}
                            <div className="bg-white p-6 rounded-xl shadow-md flex flex-col space-y-4" style={{height: '800px'}}>
                                <div className="flex justify-between items-center gap-4">
                                    <h2 className="text-xl font-semibold text-gray-700">Live Preview</h2>
                                    <div className="flex items-center gap-2">
                                        <button onClick={handleSaveSettings} className={`px-4 py-2 rounded-md font-semibold text-white transition-colors w-36 ${saveButtonText === 'Saved!' ? 'bg-green-600' : 'bg-gray-600 hover:bg-gray-700'} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500`}>
                                            {saveButtonText}
                                        </button>
                                        <button onClick={() => setIsCodeModalOpen(true)} className="px-4 py-2 rounded-md font-semibold text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors">
                                            Get Embed Code
                                        </button>
                                    </div>
                                </div>
                                <div className="w-full flex-grow bg-gray-100 rounded-lg border border-gray-300 overflow-hidden">
                                    <iframe key={generatedCode} srcDoc={generatedCode} title="Widget Live Preview" className="w-full h-full border-0" sandbox="allow-scripts allow-same-origin"></iframe>
                                </div>
                            </div>
                        </div>
                    </div>
                    <CodeModal isOpen={isCodeModalOpen} onClose={() => setIsCodeModalOpen(false)} code={generatedCode} onCopy={handleCopyCode} copyButtonText={copyButtonText} />
                </div>
            );
        }

        // --- SUB-COMPONENTS ---
        const ImageUploadInput = ({ label, value, onChange }) => {
            const [isUploading, setIsUploading] = React.useState(false);
            const [error, setError] = React.useState(null);
            const fileInputRef = React.useRef(null);

            const handleFileChange = async (event) => {
                const file = event.target.files[0];
                if (!file) return;

                if (!CLOUDINARY_CLOUD_NAME || !CLOUDINARY_UPLOAD_PRESET || CLOUDINARY_CLOUD_NAME === 'YOUR_CLOUD_NAME') {
                    setError('Cloudinary credentials are not configured.');
                    return;
                }

                setIsUploading(true);
                setError(null);

                const formData = new FormData();
                formData.append('file', file);
                formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);

                try {
                    const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`, {
                        method: 'POST',
                        body: formData,
                    });

                    if (!response.ok) {
                        throw new Error('Upload failed.');
                    }

                    const data = await response.json();
                    onChange(data.secure_url);
                } catch (err) {
                    console.error("Cloudinary upload error:", err);
                    setError('Upload failed. Please try again.');
                } finally {
                    setIsUploading(false);
                }
            };

            return (
                <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">{label}</label>
                    <div className="flex items-center gap-4">
                        <div className="w-12 h-12 flex-shrink-0 bg-gray-100 rounded-md flex items-center justify-center border">
                            <img src={value} alt="Icon Preview" className="max-w-full max-h-full object-contain" onError={(e) => { e.target.style.display='none' }}/>
                        </div>
                        <div className="flex-grow">
                            <input
                                type="text"
                                value={value}
                                onChange={(e) => onChange(e.target.value)}
                                className="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm text-sm"
                                placeholder="Enter URL or upload"
                            />
                        </div>
                        <button
                            type="button"
                            onClick={() => fileInputRef.current.click()}
                            disabled={isUploading}
                            className="px-4 py-2 text-sm font-semibold text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 disabled:opacity-50"
                        >
                            {isUploading ? 'Uploading...' : 'Upload'}
                        </button>
                        <input
                            type="file"
                            ref={fileInputRef}
                            onChange={handleFileChange}
                            className="hidden"
                            accept="image/png, image/jpeg, image/gif, image/svg+xml"
                        />
                    </div>
                    {error && <p className="text-red-500 text-sm mt-1">{error}</p>}
                </div>
            );
        };

        const CodeModal = ({ isOpen, onClose, code, onCopy, copyButtonText }) => {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 p-4 transition-opacity duration-300">
                    <div className="bg-white rounded-xl shadow-2xl w-full max-w-2xl flex flex-col" style={{maxHeight: '90vh'}}>
                        <div className="flex justify-between items-center p-4 border-b border-gray-200">
                            <h3 className="text-lg font-semibold text-gray-800">Embed Code on Your Website</h3>
                            <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
                                <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                            </button>
                        </div>
                        <div className="p-6 flex-grow overflow-y-auto">
                            <p className="text-sm text-gray-600 mb-4">Copy and paste this code into the `&lt;body&gt;` section of your website's HTML.</p>
                            <textarea
                                readOnly
                                value={code}
                                className="w-full p-4 rounded-md bg-gray-900 text-gray-300 font-mono text-sm border border-gray-700 resize-none"
                                style={{height: '300px'}}
                                aria-label="Generated HTML embed code"
                            ></textarea>
                        </div>
                        <div className="flex justify-end items-center p-4 border-t border-gray-200 bg-gray-50 rounded-b-xl">
                            <button onClick={onClose} className="px-4 py-2 mr-3 rounded-md text-gray-700 bg-gray-200 hover:bg-gray-300 transition-colors font-semibold">Close</button>
                            <button onClick={onCopy} className={`w-32 flex justify-center items-center px-4 py-2 rounded-md font-semibold text-white transition-colors ${copyButtonText === 'Copied!' ? 'bg-green-600' : 'bg-indigo-600 hover:bg-indigo-700'} focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-50 focus:ring-indigo-500`}>
                                {copyButtonText}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const ColorPresets = ({ presets, onSelect }) => {
            const [isExpanded, setIsExpanded] = React.useState(false);
            const visiblePresets = isExpanded ? presets : presets.slice(0, 10);

            return (
                <div className="space-y-3">
                    <h3 className="text-md font-semibold text-gray-600">Color Presets</h3>
                    <div className="grid grid-cols-5 sm:grid-cols-10 gap-2">
                        {visiblePresets.map(preset => (
                            <button
                                key={preset.name}
                                title={preset.name}
                                onClick={() => onSelect(preset)}
                                className="w-8 h-8 rounded-full cursor-pointer border-2 border-transparent focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition"
                                style={{ backgroundColor: preset.primary }}
                                aria-label={`Select color preset ${preset.name}`}
                            />
                        ))}
                    </div>
                    {presets.length > 10 && (
                        <button onClick={() => setIsExpanded(prev => !prev)} className="text-sm font-medium text-indigo-600 hover:text-indigo-800 flex items-center gap-1">
                            {isExpanded ? 'Show Less' : `Show More (${presets.length - 10} more)`}
                             <svg className={`w-4 h-4 transform transition-transform ${isExpanded ? 'rotate-180' : ''}`} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7"></path></svg>
                        </button>
                    )}
                </div>
            );
        };

        const ColorInput = ({ label, value, onChange }) => {
            return (
                <div>
                    <label className="block text-sm font-medium text-gray-700 mb-1">{label}</label>
                    <div className="relative">
                        <input 
                            type="text" 
                            value={value} 
                            onChange={onChange} 
                            className="w-full pl-3 pr-10 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" 
                        />
                        <div 
                            className="absolute right-1 top-1/2 -translate-y-1/2 w-8 h-7 p-0 border rounded-md" 
                            style={{ backgroundColor: value }}
                        >
                             <input 
                                type="color" 
                                value={value} 
                                onChange={onChange} 
                                className="w-full h-full opacity-0 cursor-pointer" 
                             />
                        </div>
                    </div>
                </div>
            );
        };

        const CheckboxInput = ({ label, checked, onChange }) => (
            <div className="flex items-center">
                <input id={label} type="checkbox" checked={checked} onChange={onChange} className="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" />
                <label htmlFor={label} className="ml-2 block text-sm text-gray-900">{label}</label>
            </div>
        );

        // Render the App component
        try {
            const container = document.getElementById('root');
            const root = ReactDOM.createRoot(container);
            root.render(<App />);
        } catch (error) {
            console.error("Error rendering React application:", error);
            document.getElementById('root').innerHTML = '<div style="color: red; padding: 20px; border: 1px solid red; background-color: #ffe8e8;">Error: Could not load the configurator. Please check the browser console (F12) for details.</div>';
        }
    </script>

</body>
</html>
